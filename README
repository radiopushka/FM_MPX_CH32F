THIS CODE WORKS AND HAS BEEN TESTED!
WORKS BETTER THAN MOST CHINESE FM CHIPS WHEN IT COMES TO AUDIO.
MICROCONTROLLER: CH32V307
CLOCK: 144 MHZ
DAC OUTPUT (TO MPX INPUT ON TRANSMITTER): PA4
LEFT -PA1
RIGHT- PA0


3.3v -> in4007-> 1k-470R resistor -> PA0 -> 1k-470R resistor -> in4007 ->GND
PA0->47uF capacitor -> Right channel

3.3v -> in4007-> 1k-470R resistor -> PA1 -> 1k-470R resistor -> in4007 ->GND
PA1->47uF capacitor -> Left channel

PA4 can go straight to the MPX input on your transmitter. You might need an amplifier but that depends on your transmitter, most likely you will need a variable resistor since PLL VCOs are very sensitive usually.

IN CASE YOUR AUDIO IS VERY GRAINY AND NOT CLEAR, PUT A 10 NF CAPACITOR BETWEEN PA4 AND GROUND, THEN RE ADJUST THE VOLUME


FM MPX stereo generation involves the generation of two sine waves, one at 19 khz and one at 38 khz(2nd harmonic), when the 38 khz sine wave is in phase with the 19 khz sine wave, the Right headphone is louder than the left, when the 38 KHZ sine is 180
degrees out of phase from the 19 khz sine wave, the Left headphone is louder than the right. The 38 KHZ sine is also amplitude modulated based upon that difference, the more the difference the greater the amplitude.
goal: digitally generate the signal using a single chip (FPGA or very fast MCU) to minimize quantization using good DACs and a very high sampling rate, the CH32V307 can sample at 837 KHZ which beats the raspberry PI sampling at 500 KHz at best and
225 KHz with RpiTx and Pifmrds. I do not have the exact numbers in my head, take a look at their github page. The raspberry pi really suffers from the fact that the maximum deviation of an FM signal it can generate is from 0 to 40. 40 being 
shifted 75 khz to the right of the center frequency and 0 being shifted 75 khz to the left of the frequency. This is good for something like TV transmitter, the actual signal generated by it is not that bad as people say, yes it is a square wave,
however, thats good for driving amplifiers, we can run them at higher efficiency and then take care of the output using a high-Q tuned network. Now If it would be possible to generate a relatively cheap, wide band from 76 mhz to 108 mhz, good sounding 
FM chip with a signal that looks like it was generated by a PLL VCO. Thing is we are obviously going to need the phase locked loop inside the chip or outside or whatever is optimal. All the Chinese FM chips I know of either have poor audio,
are hard to work with, or have a very dirty output signal. This is obviously not an easy task at all, this is a very difficult and complicated subject matter.
As of right now, the CH32V307 is not capable of generating RDS but as compared to other microcontrollers, it is able to generate the stereo composite signal and it is of fairly decent quality although still a little grainy.
With the 12 bit DAC and that sample rate, if I have a difference of 5 to -5 it would already give out a strong 38 khz ladder sine(not close to sine but a sine with about 6 steps up and 6 steps down)(it is actually worse than that cause 5 is not that much and thats where the distortion happens).
current solution is to just attenuate the output with a capacitor and use stereo tool's stereo difference amplifier. This approach makes the output audio more or less profesional sounding, however when the audio is quiet, it is grainy, especially when the audio is quiet and mids around 400hz are playing,
